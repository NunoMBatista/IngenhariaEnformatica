
### What is it?
OSPF is a link-state routing protocol. Unlike distance-vector protocols (like RIP) that only know the distance to destinations, link-state protocols maintain a complete map of the network topology. This map, called the link-state database (LSD), is updated whenever there are network changes and is shared securely across the network. Because all nodes have the same network map, they calculate consistent paths, which helps prevent routing loops.

#### How OSPF Works
OSPF operates directly over IP (protocol number 89), unlike RIP which runs over UDP. It is composed of three sub-protocols: Hello, Exchange, and Flooding.

##### 1 - Link-State Database (LSD)

- Every router within the same OSPF area maintains an identical Link-State Database (LSD).

- The LSD consists of Link State Records (LSRs), which are information packets about the network topology.

- There are several types of LSRs, each with a common header and a type-specific part:
	- Router-LSR (Type 1): Identifies a router and lists all connected networks.
	- Network-LSR (Type 2): Lists all routers connected to a specific network and is generated by the Designated Router (DR).
	- Summary-LSR (Type 3 & 4): Used by Area Border Routers (ABRs) to announce networks from one area to another (IP networks) or to advertise border routers to Autonomous System Boundary Routers (ASBRs). These do not circulate outside their area.
	- AS-External-LSR (Type 5): Diffused by ASBRs to carry external routing information throughout the autonomous system.


##### 2 - Hierarchical Routing (Areas)

- OSPF uses a hierarchical routing structure based on "areas" to limit the spread of routing information and reduce the size of LSDs on routers within each area. Each area has its own LSD.

- Key components of this hierarchy include:
	- Autonomous System (AS): A group of networks managed by the same entity, using the same routing protocols.
	- Backbone Area (Area 0): A special, mandatory area in OSPF networks that interconnects all other areas. Routers in this area are called Backbone Routers (BR).
	- Area Border Router (ABR): A router that interconnects two or more OSPF routing areas. It maintains an LSD for each area it is connected to and must have an interface in the backbone area.
	- Autonomous System Boundary Router (ASBR): Exchanges routing information with other autonomous systems using an external routing protocol (e.g., BGP).
	- Designated Router (DR): Elected in broadcast networks to generate link-state information for the sub-network, reducing the number of exchanges between routers.
	- Backup Designated Router (BDR): Assumes the DR's functions in case of failure.

- Types of Areas:
	- Transit Areas: Import and diffuse routing information from other areas (the backbone is a special transit area).
	- Stub Areas: Do not import or diffuse external routing information; all external routes are summarized by a default route.
	- Not-So-Stubby Areas (NSSA): A hybrid that allows connection to small secondary areas coordinated by other protocols (e.g., RIP) and permits some external routes to be represented without a default route.

- Inter-area Routing: Packets destined for another area are sent to the ABR, then transmitted to the backbone, forwarded by backbone routers to the destination area's ABR, and finally delivered to the destination.


##### 3 - OSPF Sub-Protocols

- Hello Protocol: Used to check the operational status of links/routers, and to elect the DR and BDR in broadcast networks. It sends periodic hello packets (default 10s interval).
- Exchange Protocol: Facilitates the initial synchronization of databases between adjacent systems (routers). It uses an asymmetric approach where one router (Master) sends a database description, and the other (Slave) requests updates.
- Flooding Protocol: When a link's state changes, associated routers diffuse this new state via a Link State Update (LSU). These LSUs are acknowledged, ensuring reliable and coherent database updates across the network. Each LSU contains a sequence number to prevent issues with old updates.


##### 4 - Metrics

- OSPF supports multiple metrics for calculating link costs, such as minimizing monetary cost, maximizing reliability, maximizing throughput, or minimizing delay.
- In theory, OSPF metrics could be mapped to the Type of Service (ToS) field in IP packet headers. However, with the evolution of DiffServ and the redefinition of the ToS field as DSCP, this mapping is not explicitly specified, meaning the use of different metrics in OSPF is not practically implemented. The default metric is typically associated with hop count.


#### Advantages

- Extremely Fast Convergence and No Cycles: Information is quickly transmitted via flooding, and paths are calculated locally, leading to rapid convergence without routing loops.
- Support for Multiple Metrics: Can support various metrics (throughput, delay, cost, reliability), potentially building different routing tables for each.
- Support for Multiple Paths: Can calculate and utilize multiple equivalent paths to the same destination, allowing for traffic distribution and load balancing.
- Efficient External Route Representation: Capable of maintaining link-state records for external routes, leading to more efficient external routing.
- CIDR Support: Supports Classless Inter-Domain Routing (CIDR).
- Security: Supports authentication of messages.

#### Disadvantages

- Complexity: Significantly more complex to understand and configure compared to RIP due to its mechanisms like flooding, multiple metrics, and hierarchy.
- High Resource Consumption: Requires higher processing power and memory on routers due to maintaining a complete network map and running complex algorithms (like Dijkstra).
- Scalability Challenges (without hierarchy): While hierarchical routing (areas) helps, managing a single OSPF area in a very large network can still be resource-intensive if not properly designed.
- Configuration Complexity: While basic configuration is simple, optimizing and managing large OSPF networks with multiple areas and special area types requires significant expertise.


## Configuration (CISCO) (LAB 4)

**1 - Start the OSPF routing process:** `router ospf [process-id]`

- The process-id (e.g., 100) is a locally significant number unique to the router and does not need to be the same across all routers in the autonomous system.
- Example: `router ospf 100`

**2 - Identify networks to be advertised and their OSPF area:** `network [network-address] [wildcard-mask] area [area-id]`
- network-address: The network address to include in the OSPF routing process.
- wildcard-mask: An inverse mask (e.g., 0.0.0.255 for a /24 subnet).
- area-id: The OSPF area to which the network belongs (e.g., 0 for the backbone area, or 1, 2, 3 for other areas).
- Example: `network 10.50.1.0 0.0.0.255 area 0`

**3 - Summarize routes (for ABRs):** `area [area-id] range [network-address] [netmask]`

- This command is used to aggregate contiguous routes in a specific area, announced by ABRs.
- Example: `area 1 range 10.11.0.0 255.255.0.0`

**4 - Redistribute routes from other protocols (e.g., RIP) into OSPF:** `redistribute rip subnets`

- This command is used on routers running both OSPF and another routing protocol (like RIP) to inject routes learned via RIP into the OSPF domain.
- You should also use the `area [area-id] nssa` to announce the area as a Not-so-stubby Area.